.drainpipe_pantheon_setup_terminus:
  script:
    - !reference [.drainpipe_setup_ssh, script]
    - !reference [.drainpipe_setup_git, script]
    - echo -e "Host *.drush.in\n    StrictHostKeyChecking no\n    HostkeyAlgorithms +ssh-rsa\n    PubkeyAcceptedAlgorithms +ssh-rsa" >> ~/.ssh/config
    - mkdir ~/terminus
    # Terminus default to 3.3.0; use 4.0.1 if PHP 8.3 or higher
    - |
      if [ "$PHP_MAJOR" -gt 8 ] || { [ "$PHP_MAJOR" -eq 8 ] && [ "$PHP_MINOR" -ge 3 ]; }; then
        TERMINUS_VERSION="4.0.1"
      else
        TERMINUS_VERSION="3.3.0"
      fi
    - curl -L "https://github.com/pantheon-systems/terminus/releases/download/${TERMINUS_VERSION}/terminus.phar" --output ~/terminus/terminus
    - chmod +x ~/terminus/terminus
    - ln -s ~/terminus/terminus /usr/local/bin/terminus
    - echo "$TERMINUS_PLUGINS" | while read -d, plugin || [[ -n $plugin ]]; do terminus self:plugin:install $plugin; done
    - terminus auth:login --machine-token="$PANTHEON_TERMINUS_TOKEN"
