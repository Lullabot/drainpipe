#!/bin/bash
# DO NOT EDIT THIS FILE
# This file is controlled by Drainpipe, run composer install to apply pending
# updates.
# apt-key is deprecated! We follow the guide at https://askubuntu.com/a/1307181

mkdir -p /etc/apt/keyrings
cd /etc/apt/keyrings

# The following GPG key should match the latest RPM-GPG-KEY-mysql-YYYY file
# from https://repo.mysql.com/
cat > mysql.txt << EOD
-----BEGIN PGP PUBLIC KEY BLOCK-----

xsFNBGU2rNoBEACSi5t0nL6/Hj3d0PwsbdnbY+SqLUIZ3uWZQm6tsNhvTnahvPPZ
BGdl99iWYTt2KmXp0KeN2s9pmLKkGAbacQP1RqzMFnoHawSMf0qTUVjAvhnI4+qz
MDjTNSBq9fa3nHmOYxownnrRkpiQUM/yD7/JmVENgwWb6akZeGYrXch9jd4XV3t8
OD6TGzTedTki0TDNr6YZYhC7jUm9fK9Zs299pzOXSxRRNGd+3H9gbXizrBu4L/3l
UrNf//rM7OvV9Ho7u9YYyAQ3L3+OABK9FKHNhrpi8Q0cbhvWkD4oCKJ+YZ54XrOG
0YTg/YUAs5/3//FATI1sWdtLjJ5pSb0onV3LIbarRTN8lC4Le/5kd3lcot9J8b3E
MXL5p9OGW7wBfmNVRSUI74Vmwt+v9gyp0Hd0keRCUn8lo/1V0YD9i92KsE+/IqoY
Tjnya/5kX41jB8vr1ebkHFuJ404+G6ETd0owwxq64jLIcsp/GBZHGU0RKKAo9DRL
H7rpQ7PVlnw8TDNlOtWt5EJlBXFcPL+NgWbqkADAyA/XSNeWlqonvPlYfmasnAHA
pMd9NhPQhC7hJTjCiAwG8UyWpV8Dj07DHFQ5xBbkTnKH2OrJtguPqSNYtTASbsWz
09S8ujoTDXFT17NbFM2dMIiq0a4VQB3SzH13H2io9Cbg/TzJrJGmwgoXgwARAQAB
zTZNeVNRTCBSZWxlYXNlIEVuZ2luZWVyaW5nIDxteXNxbC1idWlsZEBvc3Mub3Jh
Y2xlLmNvbT7CwZQEEwEIAD4CGwMFCwkIBwIGFQoJCAsCBBYCAwECHgECF4AWIQS8
pDQXw7SF3RKOxtS3s7eIqNN4XAUCaPoZowUJB4XTyQAKCRC3s7eIqNN4XAIED/9F
8cSgF+VHilpXe8gSTbVn5sNRnAsIYgMonsGqsrzUOv+3Gy4+e4guhRLe3m1PpQJq
yIQ/upbGptP48YsIY8ix2pyzYr1dB8W1TcNUYcQvTdb8/Exd1nDpLzdwoil7b5W2
r3jpsor/b1cou7vju/ObBbkU5xai4waCMqO9llp3ePQTJBa1RwV01taryGZJa2xR
Ke7k1lwdWINALICIQ0aSfy3Q24lWlj0CRiDxAE7UdbtBaqyr5omqUnOXR5kZdnOf
jyAbsofMuQNSLTUg1hoSunp9llv/ayeaCu54qkmkqG8U5gKUDNnYhLTIto7uf2A8
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
=donW
-----END PGP PUBLIC KEY BLOCK-----
EOD

apt-get update
apt-get -y install gnupg

gpg --no-default-keyring --keyring ./temp-keyring.gpg --import mysql.txt
gpg --no-default-keyring --keyring ./temp-keyring.gpg --export --output mysql.gpg
rm temp-keyring.gpg

# Oracle / MySQL still doesn't support Debian 11, even on newer versions of
# MySQL. However, buster packages still work.
echo 'deb [signed-by=/etc/apt/keyrings/mysql.gpg] http://repo.mysql.com/apt/debian/ buster mysql-5.7' > /etc/apt/sources.list.d/mysql.list
apt-get update

# Purge mariadb if installed
apt-get -y --autoremove purge 'mariadb*'
if [[ $PHP_VERSION =~ ^"8.2." ]]; then
  apt-get -y install default-mysql-client
else
  apt-get -y install mysql-client
fi
