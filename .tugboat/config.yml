# DO NOT EDIT THIS FILE
# This file is controlled by Drainpipe, run composer install to apply pending
# updates.  You can add values to the php service using .tugboat/config.drainpipe-override.yml.
#
# Example config.drainpipe-override.yml
# php:
#   aliases:
#   urls:
#   screenshot:
#   visualdiff:
# solr:
#   commands:
#   checkout:
#   depends:
#   volumes:
#   environment:
services:
  drainpipe:
    checkout: true
    image: tugboatqa/php-nginx:8.3-fpm-bookworm
    commands:
      init:
        - apt-get update && apt-get install libzip-dev && apt-get clean
        - docker-php-ext-install zip
        - mkdir -p /var/www/html
        - ln -snf /var/www/html /usr/share/nginx/html
        - cp .tugboat/repository-server.php /var/www/html/index.php

  php:
    http: false
    image: tugboatqa/php-nginx:8.3-fpm-bookworm
    default: true

    depends:
      - mariadb
      - redis
      - drainpipe

    commands:
      init: ./.tugboat/steps/1-init.sh
      update: ./.tugboat/steps/2-update.sh
      build: ./.tugboat/steps/3-build.sh
      online: ./.tugboat/steps/4-online.sh

    aliases:
      - foo
    urls:
      - /
      - '/?v=1'
    screenshot:
      timeout: 45
    visualdiff:
      fullPage: false

  mariadb:
    image: tugboatqa/mariadb:10.11

  redis:
    image: tugboatqa/redis:6-bullseye

  elasticsearch:
    image: tugboatqa/elasticsearch:7.17.14
